<!DOCTYPE html>
<html lang="en">
<head th:replace="~{common/config :: config}">
    <meta charset="UTF-8">
    <title>Book Details</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css">

</head>
<body>

<header th:replace="~{common/header}"></header>

<!-- 카테고리 경로 -->
<div class="container my-3" style="padding-top:20px">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="/"><img src="/images/home-icon.png"
                                                         style="padding-bottom:5px"></a></li>
            <li th:each="category, iterStat : ${categoryPaths[0]}"
                th:classappend="${iterStat.last} ? 'breadcrumb-item active' : 'breadcrumb-item'">
                <a th:href="@{/categories/{id}(id=${category.categoryId})}"
                   th:text="${category.categoryName}"></a>
            </li>
        </ol>
    </nav>
</div>


<main class="container my-5">
    <div class="row" th:each="book : ${book}">
        <!-- 책 이미지 -->
        <div class="col-md-4" style="padding-top:30px; padding-left:20px">
            <img th:src="${book.bookThumbnailImageUrl}" class="img-fluid rounded" alt="Book Cover"
                 style="height:620px">

            <!-- 태그 목록 -->
            <div class="container mb-3" style="margin-top:30px">
                <div class="d-flex flex-wrap">
                    <span th:each="tag : ${book.tags}" class="badge bg-light text-dark me-2"
                          style="font-size:1em">#<span
                            th:text="${tag.tagName}"></span></span>
                </div>
                <!--                <div class="text-muted">-->
                <!--                    <span class="badge bg-light text-dark">#학생</span>-->
                <!--                    <span class="badge bg-light text-dark">#자기계발</span>-->
                <!--                    <span class="badge bg-light text-dark">#성적상승</span>-->
                <!--                </div>-->
            </div>
        </div>

        <!-- 책 정보 -->
        <div class="col-md-8">
            <h2 th:text="${book.bookName}"></h2>
            <p class="text-muted">저자: <span th:each="item, iterStat : ${book.authors}"><span
                    th:text="${item.authorName}"></span><span th:if="${!iterStat.last}">, </span></span> |
                출판사: <span th:text="${book.publisher.publisherName}"></span> | 발행일: <span
                        th:text="${#temporals.format(book.publicationDate, 'yyyy-MM-dd')}"></span> | 조회수: <span
                        th:text="${book.bookViewCount}"></span>
            </p>
            <p class="fs-4 text-danger fw-bold"><span id="unitPrice" th:text="${book.salePrice}"></span>원
                <del class="text-muted fs-6"><span th:text="${book.regularPrice}"></span>원</del>
                <span class="fs-6 text-danger">(</span><span class="fs-6 text-danger"
                                                             th:text="${book.bookDiscount}"></span><span
                        class="fs-6 text-danger">% 할인)</span></p>

            <div class="border p-3 mb-3">
                <p>적립금: 1,000원 (5% 적립)</p>
            </div>

            <div class="border p-3 mb-3">
                <p>배송비: 무료 (배송비는 경우 지역에 따라 상이)</p>
                <p class="text-success">오늘 도착 가능</p>
            </div>

            <!-- 수량 선택과 총 금액 -->
            <div class="border p-3 mb-3">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <label for="quantity" class="me-3 mb-0">수량</label>
                    <div class="input-group w-50">
                        <button class="btn btn-outline-secondary" type="button" id="decreaseQuantity">-</button>
                        <input type="number" id="quantity" value="1" min="1" class="form-control text-center"
                               aria-label="Quantity">
                        <button class="btn btn-outline-secondary" type="button" id="increaseQuantity">+</button>
                    </div>
                </div>

                <p class="text-muted small">주문 수량 변경시 안내</p>
                <p class="text-muted small">실결제 금액은 적립금, 쿠폰 등에 따라 달라질 수 있습니다.</p>

                <div class="text-end mt-3">
                    <span class="text-total">총 금액: <span id="totalPrice" th:text="${book.salePrice}"></span>원</span>
                </div>

                <div class="d-flex justify-content-between mt-3">
                    <button class="btn btn-outline-secondary flex-fill me-1"
                            th:onclick="|window.location.href='/shop/carts/add?bookId=' + ${book.bookId}+'&quantity='+document.getElementById('quantity').value|">
                        장바구니
                    </button>
                    <button class="btn btn-success flex-fill me-1"
                            th:onclick="|window.location.href='/order-now?bookId=' + ${book.bookId}+'&quantity='+document.getElementById('quantity').value|">
                        바로구매
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 책 설명 섹션 -->
    <div class="container my-5">
        <div class="card mb-3 shadow-sm">
            <div class="card-header bg-light text-primary fw-bold" style="font-size: 2.2rem; padding: 20px;">
                책 소개
            </div>
            <div class="list-group list-group-flush">

                <!-- 스타일을 통일하기 위해 row와 col 스타일을 별도로 설정 -->
                <style>
                    .info-row {
                        margin: 0;
                        padding: 20px 30px;
                        border-bottom: 1px solid #ddd;
                    }

                    .info-title {
                        font-size: 1.8rem;
                        font-weight: bold;
                        color: #333;
                    }

                    .info-content {
                        font-size: 1.5rem;
                        color: #333;
                        line-height: 1.6;
                    }

                    .last-row {
                        border-bottom: none;
                    }
                </style>

                <!-- 주제 분류 -->
                <div class="row info-row">
                    <div class="col-md-3">
                        <h6 class="info-title">주제 분류</h6>
                    </div>
                    <div class="col-md-9">
                        <div th:each="path : ${categoryPaths}">
                            <ol class="breadcrumb mb-0" style="font-size: 1.3rem; padding: 0; margin: 0;">
                                <li th:each="category, iterStat : ${path}"
                                    th:classappend="${iterStat.last} ? 'breadcrumb-item active' : 'breadcrumb-item'">
                                    <a th:href="@{/categories/{id}(id=${category.categoryId})}"
                                       th:text="${category.categoryName}"></a>
                                </li>
                            </ol>
                        </div>
                    </div>
                </div>

                <!-- 책 설명 -->
                <div class="row info-row">
                    <div class="col-md-3">
                        <h6 class="info-title">책 설명</h6>
                    </div>
                    <div class="col-md-9">
                        <p th:text="${book.bookInfo}" class="info-content"></p>
                    </div>
                </div>

                <!-- 목차 -->
                <div class="row info-row">
                    <div class="col-md-3">
                        <h6 class="info-title">목차</h6>
                    </div>
                    <div class="col-md-9">
                        <p th:text="${book.bookIndex}" class="info-content"></p>
                    </div>
                </div>

                <!-- 작가 소개 -->
                <div class="row info-row">
                    <div class="col-md-3">
                        <h6 class="info-title">작가 소개</h6>
                    </div>
                    <div class="col-md-9">
                        <p class="info-content">저자:
                            <span th:each="item, iterStat : ${book.authors}">
                            <span th:text="${item.authorName}"></span><span th:if="${!iterStat.last}">, </span>
                        </span>
                        </p>
                    </div>
                </div>

                <!-- 출판사 소개 -->
                <div class="row info-row">
                    <div class="col-md-3">
                        <h6 class="info-title">출판사 소개</h6>
                    </div>
                    <div class="col-md-9">
                        <p th:text="${book.publisher.publisherName}" class="info-content"></p>
                    </div>
                </div>

                <!-- 기본 정보 -->
                <div class="row info-row last-row">
                    <div class="col-md-3">
                        <h6 class="info-title">기본 정보</h6>
                    </div>
                    <div class="col-md-9">
                        <ul class="info-content" style="list-style-type: none; padding-left: 0;">
                            <li><strong>ISBN:</strong> <span th:text="${book.bookIsbn}"></span></li>
                            <li><strong>발행일:</strong> <span
                                    th:text="${#temporals.format(book.publicationDate, 'yyyy-MM-dd')}"></span></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container my-5">
        <div class="card mb-3 shadow-sm">
            <div class="card-header bg-light text-primary fw-bold" style="font-size: 2.2rem; padding: 20px;">
                리뷰 (리뷰 수: <span th:text="${reviews.size()}"></span>)
            </div>
            <div class="list-group list-group-flush">
                <!-- 리뷰가 없는 경우 -->
                <div th:if="${reviews.isEmpty()}" class="p-3 text-center text-muted">
                    작성된 리뷰가 없습니다. 첫 번째 리뷰를 작성해 보세요!
                </div>
                <!-- 리뷰 리스트 -->
                <div th:each="review : ${reviews}" class="p-3 border-bottom">
                    <!-- 작성자 정보 및 날짜 -->
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div>
                            <span class="fw-bold" th:text="${review.memberId}"></span>
                            <span class="text-muted small" th:text="${#temporals.format(review.reviewCreatedAt, 'yyyy-MM-dd')}"></span>
                        </div>
                        <!-- 별점 표시 -->
                        <div class="stars">
                            <span class="star" th:classappend="${1 <= review.reviewRate} ? '' : 'empty'">★</span>
                            <span class="star" th:classappend="${2 <= review.reviewRate} ? '' : 'empty'">★</span>
                            <span class="star" th:classappend="${3 <= review.reviewRate} ? '' : 'empty'">★</span>
                            <span class="star" th:classappend="${4 <= review.reviewRate} ? '' : 'empty'">★</span>
                            <span class="star" th:classappend="${5 <= review.reviewRate} ? '' : 'empty'">★</span>
                        </div>
                    </div>

                    <!-- 리뷰 제목 -->
                    <h5 class="mt-2 fw-bold" th:text="${review.reviewTitle}" style="font-size: 1.4rem;"></h5>

                    <!-- 리뷰 이미지 -->
                    <div class="mt-2 mb-2" th:if="${review.reviewImage != null}">
                        <img th:src="${review.reviewImage}" alt="Review Image" class="img-fluid rounded"
                             style="max-width: 300px;">
                    </div>

                    <!-- 리뷰 내용 -->
                    <p class="mt-2" th:text="${review.reviewContent}" style="font-size: 1.2rem; line-height: 1.6;"></p>
                </div>
            </div>
        </div>
    </div>




</main>


<footer th:replace="~{common/footer :: footer}"></footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/book.js"></script>
</body>
</html>
