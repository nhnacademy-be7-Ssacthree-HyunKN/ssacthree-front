<!DOCTYPE html>
<html>
<head th:replace="~{common/config :: config}">

</head>
<body>
<svg xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink="http://www.w3.org/1999/xlink" style="display: none;">
    <symbol id="heart" viewBox="0 0 16 16">
        <!-- 빈 하트 아이콘 -->
        <path fill="#ffffff" fill-rule="evenodd"
              d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143q.09.083.176.171a3 3 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15"></path>
    </symbol>
    <symbol id="heart-filled" viewBox="0 0 16 16">
        <!-- 채워진 하트 아이콘 -->
        <path fill="red" fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314"></path>
    </symbol>
</svg>


<header th:replace="~{common/header}"/>

<section id="billboard" class="position-relative d-flex align-items-center py-5 bg-light-gray"
         style="background-image: url(/images/banner-image-bg.jpg); background-size: cover; background-repeat: no-repeat; background-position: center; height: 800px;">
    <div
            class="position-absolute end-0 pe-0 pe-xxl-5 me-0 me-xxl-5 swiper-next main-slider-button-next">
        <svg class="chevron-forward-circle d-flex justify-content-center align-items-center p-2"
             width="80" height="80">
            <use xlink:href="#alt-arrow-right-outline"></use>
        </svg>
    </div>
    <div
            class="position-absolute start-0 ps-0 ps-xxl-5 ms-0 ms-xxl-5 swiper-prev main-slider-button-prev">
        <svg class="chevron-back-circle d-flex justify-content-center align-items-center p-2" width="80"
             height="80">
            <use xlink:href="#alt-arrow-left-outline"></use>
        </svg>
    </div>
    <div class="swiper main-swiper">
        <div class="swiper-wrapper d-flex align-items-center">
            <div class="swiper-slide">
                <div class="container">
                    <div class="row d-flex flex-column-reverse flex-md-row align-items-center">
                        <div class="col-md-5 offset-md-1 mt-5 mt-md-0 text-center text-md-start">
                            <div class="banner-content">
                                <h3>2024 노벨문학상 수상</h3>
                                <h2>한강 작가가 쓴 5.18</h2>
                                <a th:onclick="|window.location.href='/books/' + ${banner1.bookId}|" class="btn mt-3">자세히 보기</a>
                            </div>
                        </div>
                        <div class="col-md-6 text-center">
                            <div class="image-holder">
                                <img th:src="${banner1.bookThumbnailImageUrl}"
                                     class="img-fluid" alt="banner" style="height:500px">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="container">
                    <div class="row d-flex flex-column-reverse flex-md-row align-items-center">
                        <div class="col-md-5 offset-md-1 mt-5 mt-md-0 text-center text-md-start">
                            <div class="banner-content">
                                <h3>조회수 1위</h3>
                                <h2>현재 인기 도서</h2>
                                <a th:onclick="|window.location.href='/books/' + ${banner2.bookId}|" class="btn mt-3">자세히 보기</a>
                            </div>
                        </div>
                        <div class="col-md-6 text-center">
                            <div class="image-holder">
                                <img th:src="${banner2.bookThumbnailImageUrl}" class="img-fluid" alt="banner" style="height:500px">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="swiper-slide">
                <div class="container">
                    <div class="row d-flex flex-column-reverse flex-md-row align-items-center">
                        <div class="col-md-5 offset-md-1 mt-5 mt-md-0 text-center text-md-start">
                            <div class="banner-content">
                                <h2>Your Heart is the Sea</h2>
                                <p>Limited stocks available. Grab it now!</p>
                                <a href="" class="btn mt-3">자세히 보기</a>
                            </div>
                        </div>
                        <div class="col-md-6 text-center">
                            <div class="image-holder">
                                <img src="/images/banner-image.png" class="img-fluid" alt="banner">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>


<!-- best-selling-items 섹션 -->
<section id="best-selling-items" class="position-relative padding-large">
    <div class="container">

        <div class="section-title d-md-flex justify-content-between align-items-center mb-4">
            <h3 class="d-flex align-items-center">한강 2024 노벨문학상 수상 <img src="/images/award-icon.png"
                                                                        style="padding-bottom:5px; margin-left:10px;"/>
            </h3>
            <a href="#" th:href="@{/books(author-id=336)}" class="btn">더보기</a>
        </div>
        <!-- Swiper navigation buttons -->
        <div class="position-absolute top-50 end-0 pe-0 pe-xxl-5 me-0 me-xxl-5 swiper-button-next">
            <svg class="chevron-forward-circle d-flex justify-content-center align-items-center p-2" width="80"
                 height="80">
                <use xlink:href="#alt-arrow-right-outline"></use>
            </svg>
        </div>
        <div class="position-absolute top-50 start-0 ps-0 ps-xxl-5 ms-0 ms-xxl-5 swiper-button-prev">
            <svg class="chevron-back-circle d-flex justify-content-center align-items-center p-2" width="80"
                 height="80">
                <use xlink:href="#alt-arrow-left-outline"></use>
            </svg>

        </div>

        <div class="swiper product-swiper">
            <div class="swiper-wrapper">
                <!-- 책 리스트를 반복하여 렌더링 -->
                <div class="swiper-slide" th:each="book : ${books}">
                    <!-- 카드 전체 클릭 시 링크 이동 -->
                    <div class="card position-relative p-4 border rounded-3"
                         th:onclick="|window.location.href='/books/' + ${book.bookId}|"
                         style="cursor: pointer; height: 525px;">

                        <!-- 할인 정보 -->
                        <div class="position-absolute">
                            <p class="bg-primary py-1 px-3 fs-6 text-white rounded-2"
                               th:text="${book.bookDiscount} + '% off'">10% off</p>
                        </div>

                        <!-- 책 이미지 -->
                        <img th:src="${book.bookThumbnailImageUrl}" class="img-fluid shadow-sm"
                             alt="book cover">

                        <!-- 책 제목 및 상세 정보 -->
                        <h6 class="mt-4 mb-0 fw-bold"
                            th:text="${#strings.length(book.bookName) > 50 ? #strings.substring(book.bookName, 0, 47) + '...' : book.bookName}">
                            Book Title
                        </h6>

                        <!-- 작가 이름 -->
                        <!--              <p class="my-2 me-2 fs-6 text-black-50"><span th:each="item, iterStat : ${book.authors}"><span th:text="${item.authorName}"></span><span th:if="${!iterStat.last}">, </span></span></p>-->

                        <!-- 리뷰 별점 -->
                        <div class="review-content d-flex">
                            <div class="rating text-warning d-flex align-items-center">
                                <!-- 별점 반복 렌더링 -->
                                <svg th:each="i : ${#numbers.sequence(1, 5)}"
                                     th:classappend="${i <= book.reviewRateAverage} ? 'text-warning' : 'text-muted'"
                                     class="rating-star"
                                     style="width:20px; height:20px">
                                    <use xlink:href="#star-fill"></use>
                                </svg>
                            </div>
                        </div>

                        <!-- 가격 정보 -->
                        <p><span class="price text-primary fw-bold mb-2 fs-5 unitPrice"
                                 th:text="${book.salePrice}">$0.00</span>원</p>

                        <!-- 액션 버튼 (카드 클릭 제외) -->
                        <div class="card-concern position-absolute start-0 end-0 d-flex gap-2">
                            <button type="button" class="btn btn-dark cart-button"
                                    th:onclick="|window.location.href='/shop/carts/add?bookId=' + ${book.bookId}+'&quantity='+1|"
                                    data-bs-toggle="tooltip" data-bs-placement="top"
                                    data-bs-title="Tooltip on top">
                                <svg class="cart">
                                    <use xlink:href="#cart"></use>
                                </svg>
                            </button>
                            <div class="btn btn-dark wishlist-button">
                                    <span><svg class="wishlist"
                                               style="width: 25px; height: 25px; cursor: pointer;"
                                               th:classappend="${likeBooks != null and likeBooks.contains(book.bookId)} ? 'liked' : ''"
                                               th:data-book-id="${book.bookId}"
                                               onclick="toggleLike(this)">
                                                <use th:if="${likeBooks != null and likeBooks.contains(book.bookId)}" xlink:href="#heart-filled"></use>
                                                <use th:unless="${likeBooks != null and likeBooks.contains(book.bookId)}" xlink:href="#heart"></use>

                                            </svg></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>

        <div class="swiper-pagination" style="margin-bottom: 2em"></div>
    </div>
</section>

<!-- New Items Section -->
<section id="new-items" class="position-relative padding-large">
    <div class="container">
        <div class="section-title d-flex align-items-center mb-3">
            <h3 class="fw-bold text-dark me-3">화제의 🌟 신간이에요</h3>
        </div>

        <div class="filter-buttons d-flex flex-wrap gap-2 mb-4">
            <!-- 종합 버튼 -->
            <button class="btn btn-filter active"
                    th:onclick="">
                종합
            </button>

            <!-- 카테고리 버튼 -->
            <div th:each="rootCategory : ${rootCategories}">
                <button class="btn btn-filter" th:text="${rootCategory.categoryName}"
                        th:data-category-id="${rootCategory.categoryId}">
                </button>
            </div>
        </div>

        <div class="swiper new-items-swiper">
            <!-- 책 리스트 반복 -->
            <div class="swiper-slide">
                <div class="row justify-content-center" id="book-container">
                    <!-- 책 리스트를 반복적으로 렌더링 -->

                </div>
            </div>


        </div>

    </div>

</section>



<style>
    /* 필터 버튼 스타일 */
    .btn-filter {
        background-color: #f1f1f1;
        color: #333;
        border: none;
        border-radius: 20px;
        padding: 5px 15px;
        font-size: 0.9rem;
        transition: background-color 0.2s, color 0.2s;
    }

    .btn-filter:hover {
        background-color: #e0e0e0;
    }

    .btn-filter.active {
        background-color: #f86d72;
        color: #fff;
    }


</style>

<footer th:replace="~{common/footer :: footer}"/>
<script src="/js/index.js"></script>
<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>


<!-- 로그인 실패 시 Alert창 띄우는 용도 -->
<div id="loginFailedMessage" th:text="${loginFailedMessage}" style="display: none;"></div>
<div id="registerSuccessMessage" th:text="${registered}" style="display: none;"></div>
<div id="memberActiveMessage" th:text="${memberActiveMessage}" style="display: none;"></div>
<script>
  // loginFailedMessage가 있는 경우 alert 창을 띄웁니다.
  window.addEventListener('DOMContentLoaded', () => {
    const loginFailedMessageElement = document.getElementById('loginFailedMessage');
    const loginFailedMessage = loginFailedMessageElement ? loginFailedMessageElement.textContent
        : null;

    if (loginFailedMessage) {
      alert(loginFailedMessage);
    }
  });

  window.addEventListener('DOMContentLoaded', () => {
    const registeredElement = document.getElementById('registerSuccessMessage');
    const registered = registeredElement ? registeredElement.textContent
        : null;

    if (registered) {
      alert(registered);
    }
  });

  window.addEventListener('DOMContentLoaded', () => {
    const memberActiveMessageElement = document.getElementById('memberActiveMessage')
    const memberActiveMessage = memberActiveMessageElement ? memberActiveMessageElement.textContent
        : null;

    if (memberActiveMessage) {
      alert(memberActiveMessage)
    }
  });
</script>

<script>
    var likeBooks = [[${likeBooks}]]; // Thymeleaf를 통해 서버에서 제공된 변수 전달
</script>

<script src="/js/bookLike.js"></script>
<script src="/js/unitPrice.js"></script>
<script src="/js/mainPage.js"></script>

</body>
<svg style="display: none;">
    <!-- 채워진 별 -->
    <symbol id="star-fill" viewBox="0 0 16 16" fill="currentColor">
        <path d="M3.612 15.443C3.204 15.62 2.641 15.193 2.774 14.723L3.346 12.62 1.64 11.036C1.272 10.693 1.513 10.025 2.01 9.975L4.12 9.761 5.025 7.682C5.236 7.208 5.764 7.208 5.975 7.682L6.88 9.761 8.99 9.975C9.487 10.025 9.728 10.693 9.36 11.036L7.654 12.62 8.226 14.723C8.359 15.193 7.796 15.62 7.388 15.443L5.81 14.654 4.23 15.443H3.612Z" />
    </symbol>
</svg>
</html>
